language: java
install: true
os: linux
dist: trusty
jdk: openjdk8
stages:
- name: build
- name: snapshot
  if: branch = master AND type IN (push)
- name: release
  if: "(branch = release-0.7.x OR branch = release-0.8.x OR branch = release-0.9.x)
    AND type IN (push)"
jobs:
  include:
  - stage: build
    script: "./gradlew --stacktrace build"
  - stage: release
    script: "./gradlew --stacktrace publishToSonatype"
before_cache:
- rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
- rm -fr $HOME/.gradle/caches/*/plugin-resolution/
cache:
  directories:
  - "$HOME/.gradle/caches/"
  - "$HOME/.gradle/wrapper/"
env:
  global:
  - secure: YbDXh34oInSVySvrit4bZHyLQA9iKZn6y2Z4FtlRyoYHXmPh95cF9y6T7fBCV81v9/xXe9Hn6Qcwf1d4fCtvqohegQEga1Ig0OKnAKV2loX3mxHZ0O6SBmTCt0GhPWR5HggVskfEqnUNNq1lsZhWJL2WpS4Y7UXe+Gsba58UCJXO/PksoAejThB+8JjPhZ45cr6iP85YTkn177EKrP3XRvSIkBiGdeIc22hfVNRHfgKuF1LaTW94iAT6dxo31G1d0/KKO9JYPedvfQpAY6jlNPFP2yd+4fox1w9GcTDmNY7ACclDTMEsp5+V6scrzBBeVgjSvNWQH9DFTOSjR2PBQXE3WjOuLKguHzNCxz2fI8Sia6j+6TsWmI3QmbLnMkJdPse4u/0skw5GG2xd2+yHBygBqcP+39p88XFzacLtLd+CkPPNr8ssTrQt4g5v+7YH225/yT1V6LKUorh3/cLRkwew+2Mstr2i8vD9BEs23fRlI/cZUtIqk/Uu1NUA9L0GrGPdligKIE71ssJtyCSP05NRp3nczERaf4BfD+eBLEiQABgAzlowxb2A1DQ6Mr7rgm8DPIVVWYcQlJOb8x+mFOEtTboTSv12w9VVPtRl1Z8pebNOva4kWbRikQl9BdqpJhhMA6FZDfw8uaupoRvb7+/r+KGqW8WkE+tUW+QTHPE=
  - secure: XhHV8fAFIDNeLW7wvfLhJcHJvLmzXBbzRFT+5VLFY4gip+rfsncJeWm7TPkt9gBzg+zmsaEnmM4j4lrBrTijDINgauZq136D+DklLlSVuijOnvNl4EHuNNsbiJvtw9EvLU2F6giUu5Hj37j/jnreVDHHU7CocY8JMgIjPzFiSoCbg2AuJ1hB/NannInzY+ou1EhHBAcrYW4Zav+Kf4sL8Del8WLtOagYP6VhjGWqFG5ZCXtDZF87zyKQNVj9uvKfsZAVV0q4lyhYG6quvwgtvIQhAYLiRRw7I1UA2Cu1Bp2D7YiG485FFmGUZS6Ek++XTTqMxROCf/6Qbjs8S258XIynd5DGZImQT17jmGFk0/ZPumiFvLMIcYXsgsj7liLZsGetgTzHppfBGE17//EDFgVy47LeRd8nWTQJmqGH+4IgdQOa6+9F1l9Th430ZzaufuX6X/hEjdq4xOBZoP/IBFyUufHmY/9DL2l4ni1K0f0K7lKoO1tkvh9EeSSHEvyvvmiLhszzEObMGzcB8oB8akmWJB7QwUJMpx95ZebvztzcLV9QmqP7l5/kDrStnFtq134SHtn8ybWm8rK0si4ptr2uH+7lROnuyAo1yARrKU8PGliRSpINmcNSMW+313ZMGPICrHrKmQK4dpWPJyJa/JXD7O3h8RUNYh/PQ6e8kQo=
before_install:
- openssl aes-256-cbc -K $encrypted_2fc2577d012c_key -iv $encrypted_2fc2577d012c_iv
  -in cd/gradle.properties.enc -out cd/gradle.properties -d
- openssl aes-256-cbc -K $encrypted_81c98acad902_key -iv $encrypted_81c98acad902_iv
  -in cd/codesigning.asc.enc -out cd/codesigning.asc -d
- gpg --fast-import cd/codesigning.asc
- export USER_HOME=$HOME
